# Processã€Queueã€Threadã€å”ç¨‹ï¼ˆCoroutineï¼‰è©³è§£

## æ¦‚è¿°

é€™å››å€‹æ¦‚å¿µéƒ½èˆ‡ã€Œä¸¦ç™¼åŸ·è¡Œã€ç›¸é—œï¼Œä½†å®ƒå€‘è™•æ–¼ä¸åŒçš„æŠ½è±¡å±¤ç´šï¼š

| æ¦‚å¿µ              | å±¤ç´š            | ç®¡ç†è€…     | é–‹éŠ·                   |
| ----------------- | --------------- | ---------- | ---------------------- |
| Processï¼ˆé€²ç¨‹ï¼‰   | ä½œæ¥­ç³»çµ±å±¤ç´š    | OS æ ¸å¿ƒ    | æœ€é‡ï¼ˆç¨ç«‹è¨˜æ†¶é«”ç©ºé–“ï¼‰ |
| Threadï¼ˆç·šç¨‹ï¼‰    | ä½œæ¥­ç³»çµ±å±¤ç´š    | OS æ ¸å¿ƒ    | é‡é‡ç´šï¼ˆKB ç´šåˆ¥ï¼‰      |
| Queueï¼ˆä½‡åˆ—ï¼‰     | æŠ½è±¡èª¿åº¦å±¤ç´š    | GCD/ç³»çµ±   | ä¸­ç­‰                   |
| Coroutineï¼ˆå”ç¨‹ï¼‰ | ç”¨æˆ¶æ…‹/èªè¨€å±¤ç´š | èªè¨€é‹è¡Œæ™‚ | è¼•é‡ç´šï¼ˆå­—ç¯€ç´šåˆ¥ï¼‰     |

---

## ä¸€ã€Processï¼ˆé€²ç¨‹ï¼‰

### ä»€éº¼æ˜¯ Processï¼Ÿ

Processï¼ˆé€²ç¨‹ï¼‰æ˜¯**ä½œæ¥­ç³»çµ±é€²è¡Œè³‡æºåˆ†é…çš„åŸºæœ¬å–®ä½**ã€‚æ¯å€‹ App åœ¨é‹è¡Œæ™‚å°±æ˜¯ä¸€å€‹é€²ç¨‹ï¼Œæ“æœ‰ç¨ç«‹çš„è¨˜æ†¶é«”ç©ºé–“å’Œç³»çµ±è³‡æºã€‚

### Process vs Thread çš„é—œä¿‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä½œæ¥­ç³»çµ± (Operating System)                   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚      Process A          â”‚    â”‚      Process B          â”‚        â”‚
â”‚  â”‚      (App A)            â”‚    â”‚      (App B)            â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”‚        â”‚
â”‚  â”‚  â”‚Thread1â”‚ â”‚Thread2â”‚   â”‚    â”‚  â”‚Thread1â”‚ â”‚Thread2â”‚   â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚        â”‚
â”‚  â”‚                         â”‚    â”‚                         â”‚        â”‚
â”‚  â”‚  ç¨ç«‹çš„è¨˜æ†¶é«”ç©ºé–“        â”‚    â”‚  ç¨ç«‹çš„è¨˜æ†¶é«”ç©ºé–“        â”‚        â”‚
â”‚  â”‚  (Heap, Stack, Code)    â”‚    â”‚  (Heap, Stack, Code)    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                      â”‚
â”‚  é€²ç¨‹ä¹‹é–“è¨˜æ†¶é«”éš”é›¢ï¼Œç„¡æ³•ç›´æ¥è¨ªå•å°æ–¹çš„æ•¸æ“š                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Process çš„ç‰¹é»

| ç‰¹æ€§       | èªªæ˜                                          |
| ---------- | --------------------------------------------- |
| è¨˜æ†¶é«”éš”é›¢ | æ¯å€‹é€²ç¨‹æœ‰ç¨ç«‹çš„è™›æ“¬è¨˜æ†¶é«”ç©ºé–“                |
| è³‡æºç¨ç«‹   | æ“æœ‰ç¨ç«‹çš„æª”æ¡ˆæè¿°ç¬¦ã€ç¶²è·¯é€£æ¥ç­‰ç³»çµ±è³‡æº      |
| å´©æ½°éš”é›¢   | ä¸€å€‹é€²ç¨‹å´©æ½°ä¸æœƒå½±éŸ¿å…¶ä»–é€²ç¨‹                  |
| é–‹éŠ·å¤§     | å‰µå»º/éŠ·æ¯€é€²ç¨‹éœ€è¦åˆ†é…/å›æ”¶å¤§é‡ç³»çµ±è³‡æº        |
| é€²ç¨‹é–“é€šä¿¡ | éœ€è¦ç‰¹æ®Šæ©Ÿåˆ¶ï¼ˆIPCï¼‰ï¼šç®¡é“ã€å…±äº«è¨˜æ†¶é«”ã€Socket |

### iOS ä¸­çš„ Process

```swift
// ç²å–ç•¶å‰é€²ç¨‹è³‡è¨Š
let processInfo = ProcessInfo.processInfo

// é€²ç¨‹ ID
print("PID: \(processInfo.processIdentifier)")

// é€²ç¨‹åç¨±
print("Process Name: \(processInfo.processName)")

// ç³»çµ±é‹è¡Œæ™‚é–“
print("System Uptime: \(processInfo.systemUptime)")

// å¯ç”¨è¨˜æ†¶é«”
print("Physical Memory: \(processInfo.physicalMemory / 1024 / 1024) MB")
```

### iOS App çš„é€²ç¨‹æ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     iOS ç³»çµ±                                 â”‚
â”‚                                                              â”‚
â”‚   æ¯å€‹ App = ä¸€å€‹ç¨ç«‹çš„ Process                              â”‚
â”‚                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚   ä½ çš„ App   â”‚  â”‚   Safari    â”‚  â”‚   éŸ³æ¨‚ App   â”‚        â”‚
â”‚   â”‚  Process A  â”‚  â”‚  Process B  â”‚  â”‚  Process C  â”‚        â”‚
â”‚   â”‚             â”‚  â”‚             â”‚  â”‚             â”‚        â”‚
â”‚   â”‚ Main Thread â”‚  â”‚ Main Thread â”‚  â”‚ Main Thread â”‚        â”‚
â”‚   â”‚ BG Threads  â”‚  â”‚ BG Threads  â”‚  â”‚ BG Threads  â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                              â”‚
â”‚   é€²ç¨‹ä¹‹é–“å®Œå…¨éš”é›¢ï¼Œä¿è­‰å®‰å…¨æ€§å’Œç©©å®šæ€§                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Process vs Thread æ¯”è¼ƒ

| ç‰¹æ€§     | Processï¼ˆé€²ç¨‹ï¼‰        | Threadï¼ˆç·šç¨‹ï¼‰       |
| -------- | ---------------------- | -------------------- |
| å®šç¾©     | è³‡æºåˆ†é…çš„åŸºæœ¬å–®ä½     | CPU èª¿åº¦çš„åŸºæœ¬å–®ä½   |
| è¨˜æ†¶é«”   | ç¨ç«‹çš„è¨˜æ†¶é«”ç©ºé–“       | å…±äº«æ‰€å±¬é€²ç¨‹çš„è¨˜æ†¶é«” |
| å‰µå»ºé–‹éŠ· | å¤§ï¼ˆéœ€åˆ†é…ç¨ç«‹è³‡æºï¼‰   | å°ï¼ˆå…±äº«é€²ç¨‹è³‡æºï¼‰   |
| é€šä¿¡æ–¹å¼ | IPCï¼ˆé€²ç¨‹é–“é€šä¿¡ï¼‰      | ç›´æ¥å…±äº«è¨˜æ†¶é«”       |
| å´©æ½°å½±éŸ¿ | ä¸å½±éŸ¿å…¶ä»–é€²ç¨‹         | å¯èƒ½å°è‡´æ•´å€‹é€²ç¨‹å´©æ½° |
| åˆ‡æ›é–‹éŠ· | å¤§ï¼ˆéœ€åˆ‡æ›è¨˜æ†¶é«”ç©ºé–“ï¼‰ | å°ï¼ˆåŒä¸€è¨˜æ†¶é«”ç©ºé–“ï¼‰ |

---

## äºŒã€Threadï¼ˆç·šç¨‹/åŸ·è¡Œç·’ï¼‰

### ä»€éº¼æ˜¯ Threadï¼Ÿ

Thread æ˜¯**ä½œæ¥­ç³»çµ±é€²è¡Œ CPU èª¿åº¦çš„æœ€å°å–®ä½**ã€‚æ¯å€‹é€²ç¨‹ï¼ˆProcessï¼‰è‡³å°‘åŒ…å«ä¸€å€‹ç·šç¨‹ï¼Œç·šç¨‹å…±äº«é€²ç¨‹çš„è¨˜æ†¶é«”ç©ºé–“ã€‚

### ç‰¹é»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Process                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Thread 1â”‚  â”‚ Thread 2â”‚  â”‚ Thread 3â”‚         â”‚
â”‚  â”‚  Stack  â”‚  â”‚  Stack  â”‚  â”‚  Stack  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                  â”‚
â”‚          å…±äº«çš„ Heapã€å…¨åŸŸè®Šæ•¸ã€ç¨‹å¼ç¢¼            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **ç”±ä½œæ¥­ç³»çµ±ç®¡ç†**ï¼šç·šç¨‹çš„å‰µå»ºã€éŠ·æ¯€ã€èª¿åº¦éƒ½ç”± OS æ ¸å¿ƒè² è²¬
- **æ“æœ‰ç¨ç«‹çš„ Stack**ï¼šæ¯å€‹ç·šç¨‹æœ‰è‡ªå·±çš„èª¿ç”¨å †ç–Šï¼ˆé€šå¸¸ 512KB - 1MBï¼‰
- **å…±äº«è¨˜æ†¶é«”ç©ºé–“**ï¼šåŒä¸€é€²ç¨‹çš„ç·šç¨‹å…±äº« Heapã€å…¨åŸŸè®Šæ•¸
- **ä¸Šä¸‹æ–‡åˆ‡æ›æˆæœ¬é«˜**ï¼šåˆ‡æ›ç·šç¨‹éœ€è¦ä¿å­˜/æ¢å¾©æš«å­˜å™¨ã€å †ç–ŠæŒ‡æ¨™ç­‰
- **æ•¸é‡æœ‰é™**ï¼šç³»çµ±è³‡æºæœ‰é™ï¼Œä¸é©åˆå‰µå»ºå¤§é‡ç·šç¨‹

### iOS ä¸­çš„ Thread

```swift
// ä½¿ç”¨ NSThread
let thread = Thread {
    print("Running on thread: \(Thread.current)")
}
thread.start()

// ä¸»ç·šç¨‹
Thread.isMainThread  // æª¢æŸ¥æ˜¯å¦åœ¨ä¸»ç·šç¨‹
```

### Thread çš„ç”Ÿå‘½é€±æœŸ

```
æ–°å»º (New) â†’ å°±ç·’ (Ready) â†’ é‹è¡Œ (Running) â†’ é˜»å¡ (Blocked) â†’ çµ‚æ­¢ (Terminated)
                â†‘               â†“
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  (æ™‚é–“ç‰‡ç”¨å®Œ/è¢«æ¶ä½”)
```

---

## ä¸‰ã€Queueï¼ˆä½‡åˆ—ï¼‰

### ä»€éº¼æ˜¯ Queueï¼Ÿ

Queue æ˜¯ä¸€å€‹**ä»»å‹™èª¿åº¦çš„æŠ½è±¡æ¦‚å¿µ**ï¼Œæ˜¯ä¸€å€‹ã€Œå¾…åŸ·è¡Œä»»å‹™çš„å®¹å™¨ã€ã€‚åœ¨ iOS ä¸­ï¼ŒQueue ä¸»è¦æŒ‡ **Dispatch Queue**ï¼ˆGCD çš„æ ¸å¿ƒï¼‰ã€‚

### Queue vs Thread çš„é—œä¿‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Queue å±¤                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚   â”‚ Serial Queue â”‚    â”‚Concurrent Q. â”‚                    â”‚
â”‚   â”‚ Task A       â”‚    â”‚ Task 1       â”‚                    â”‚
â”‚   â”‚ Task B       â”‚    â”‚ Task 2       â”‚                    â”‚
â”‚   â”‚ Task C       â”‚    â”‚ Task 3       â”‚                    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                   â”‚
           â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Thread Pool                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚Thread 1 â”‚  â”‚Thread 2 â”‚  â”‚Thread 3 â”‚  â”‚Thread 4 â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—œéµé»ï¼šQueue æ±ºå®šã€Œä»»å‹™å¦‚ä½•æ’éšŠã€ï¼ŒThread Pool æ±ºå®šã€Œä»»å‹™åœ¨å“ªåŸ·è¡Œã€
```

### Queue çš„é¡å‹

| é¡å‹                 | ç‰¹é»           | åŸ·è¡Œæ–¹å¼                 |
| -------------------- | -------------- | ------------------------ |
| **Serial Queue**     | ä¸²è¡ŒéšŠåˆ—       | ä»»å‹™ä¸€å€‹æ¥ä¸€å€‹åŸ·è¡Œï¼ŒFIFO |
| **Concurrent Queue** | ä½µç™¼éšŠåˆ—       | å¤šå€‹ä»»å‹™å¯åŒæ™‚åŸ·è¡Œ       |
| **Main Queue**       | ä¸»éšŠåˆ—ï¼ˆä¸²è¡Œï¼‰ | æ‰€æœ‰ä»»å‹™åœ¨ä¸»ç·šç¨‹åŸ·è¡Œ     |

### åŒæ­¥ï¼ˆsyncï¼‰vs ç•°æ­¥ï¼ˆasyncï¼‰åŸ·è¡Œ

é€™æ˜¯ GCD ä¸­æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€ï¼

| ç‰¹æ€§                 | syncï¼ˆåŒæ­¥ï¼‰          | asyncï¼ˆç•°æ­¥ï¼‰       |
| -------------------- | --------------------- | ------------------- |
| **æ˜¯å¦ç­‰å¾…**         | âœ… ç­‰å¾…ä»»å‹™å®Œæˆæ‰è¿”å› | âŒ ç«‹å³è¿”å›ï¼Œä¸ç­‰å¾… |
| **æ˜¯å¦é˜»å¡ç•¶å‰ç·šç¨‹** | âœ… é˜»å¡               | âŒ ä¸é˜»å¡           |
| **åŸ·è¡Œé †åº**         | å¯é æ¸¬                | ä¸å¯é æ¸¬            |
| **ä½¿ç”¨å ´æ™¯**         | éœ€è¦ç­‰å¾…çµæœæ™‚        | ä¸éœ€è¦ç­‰å¾…æ™‚        |

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    sync vs async åŸ·è¡Œæµç¨‹                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ã€sync åŒæ­¥åŸ·è¡Œã€‘                                               â”‚
â”‚                                                                  â”‚
â”‚  ç•¶å‰ç·šç¨‹ â”€â”€â”€â–¶ æäº¤ä»»å‹™ â”€â”€â”€â–¶ ç­‰å¾…... â”€â”€â”€â–¶ ä»»å‹™å®Œæˆ â”€â”€â”€â–¶ ç¹¼çºŒ    â”‚
â”‚                              â¬†ï¸                                  â”‚
â”‚                           é˜»å¡åœ¨é€™è£¡                              â”‚
â”‚                                                                  â”‚
â”‚  æ™‚é–“è»¸: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶             â”‚
â”‚          A â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• B                          â”‚
â”‚          â†‘ å‘¼å« sync                  â†‘ sync è¿”å›                â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ã€async ç•°æ­¥åŸ·è¡Œã€‘                                              â”‚
â”‚                                                                  â”‚
â”‚  ç•¶å‰ç·šç¨‹ â”€â”€â”€â–¶ æäº¤ä»»å‹™ â”€â”€â”€â–¶ ç«‹å³è¿”å› â”€â”€â”€â–¶ ç¹¼çºŒåŸ·è¡Œ              â”‚
â”‚                    â”‚                                             â”‚
â”‚                    â–¼                                             â”‚
â”‚  å…¶ä»–ç·šç¨‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ åŸ·è¡Œä»»å‹™ â”€â”€â”€â–¶ å®Œæˆ                      â”‚
â”‚                                                                  â”‚
â”‚  æ™‚é–“è»¸: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶             â”‚
â”‚          A â•â• B                                                  â”‚
â”‚          â†‘    â†‘ async ç«‹å³è¿”å›                                   â”‚
â”‚          å‘¼å« async                                              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### sync åŒæ­¥åŸ·è¡Œ

```swift
print("1. é–‹å§‹")

DispatchQueue.global().sync {
    // ç•¶å‰ç·šç¨‹æœƒã€Œç­‰å¾…ã€é€™å€‹ Block åŸ·è¡Œå®Œç•¢
    print("2. sync ä»»å‹™åŸ·è¡Œä¸­...")
    Thread.sleep(forTimeInterval: 2)
    print("3. sync ä»»å‹™å®Œæˆ")
}

// sync è¿”å›å¾Œæ‰æœƒåŸ·è¡Œé€™è¡Œ
print("4. çµæŸ")

// è¼¸å‡ºé †åºï¼š1 â†’ 2 â†’ 3 â†’ 4ï¼ˆçµ•å°æœ‰åºï¼‰
```

#### async ç•°æ­¥åŸ·è¡Œ

```swift
print("1. é–‹å§‹")

DispatchQueue.global().async {
    // ç•¶å‰ç·šç¨‹ã€Œä¸ç­‰å¾…ã€ï¼Œç«‹å³è¿”å›
    print("2. async ä»»å‹™åŸ·è¡Œä¸­...")
    Thread.sleep(forTimeInterval: 2)
    print("3. async ä»»å‹™å®Œæˆ")
}

// async ç«‹å³è¿”å›ï¼Œé¦¬ä¸ŠåŸ·è¡Œé€™è¡Œ
print("4. çµæŸ")

// å¯èƒ½çš„è¼¸å‡ºé †åºï¼š1 â†’ 4 â†’ 2 â†’ 3ï¼ˆ4 æ¯” 2 å…ˆåŸ·è¡Œï¼ï¼‰
```

#### ç”¨ç”Ÿæ´»ä¾‹å­ç†è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”Ÿæ´»ä¸­çš„ sync vs async                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ã€sync åŒæ­¥ã€‘= æ‰“é›»è©±                                           â”‚
â”‚  ğŸ“ ä½ æ‰“é›»è©±çµ¦æœ‹å‹ï¼Œç­‰ä»–æ¥è½ã€èªªå®Œè©±ï¼Œä½ æ‰èƒ½åšå…¶ä»–äº‹              â”‚
â”‚     â†’ ä½ è¢«ã€Œé˜»å¡ã€åœ¨é›»è©±æ—é‚Š                                     â”‚
â”‚                                                                  â”‚
â”‚  ã€async ç•°æ­¥ã€‘= ç™¼è¨Šæ¯                                          â”‚
â”‚  ğŸ’¬ ä½ ç™¼è¨Šæ¯çµ¦æœ‹å‹ï¼Œç™¼å®Œå°±ç¹¼çºŒåšè‡ªå·±çš„äº‹                         â”‚
â”‚     â†’ ä½ ä¸éœ€è¦ç­‰å¾…ï¼Œè¨Šæ¯æœƒåœ¨ã€ŒæŸå€‹æ™‚å€™ã€è¢«å›è¦†                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Queue é¡å‹ + åŸ·è¡Œæ–¹å¼çš„çµ„åˆ

| çµ„åˆ                         | æ•ˆæœ                                    |
| ---------------------------- | --------------------------------------- |
| Serial Queue + sync          | é˜»å¡ç•¶å‰ç·šç¨‹ï¼Œä¸²è¡ŒåŸ·è¡Œ                  |
| Serial Queue + async         | ä¸é˜»å¡ï¼Œä¸²è¡ŒåŸ·è¡Œï¼ˆä¸€å€‹æ¥ä¸€å€‹ï¼‰          |
| Concurrent Queue + sync      | é˜»å¡ç•¶å‰ç·šç¨‹ï¼Œä½† Queue å…§å…¶ä»–ä»»å‹™å¯ä¸¦è¡Œ |
| Concurrent Queue + async     | ä¸é˜»å¡ï¼Œå¤šä»»å‹™ä¸¦è¡ŒåŸ·è¡Œ                  |
| Main Queue + async           | ä¸é˜»å¡ï¼Œä»»å‹™åœ¨ä¸»ç·šç¨‹åŸ·è¡Œ                |
| Main Queue + sync (åœ¨ä¸»ç·šç¨‹) | âŒ **æ­»é–ï¼**                           |

#### å¯¦éš›æ‡‰ç”¨å ´æ™¯

```swift
// å ´æ™¯ 1: èƒŒæ™¯ä¸‹è¼‰ + UI æ›´æ–°ï¼ˆæœ€å¸¸è¦‹ï¼‰
DispatchQueue.global().async {
    // èƒŒæ™¯åŸ·è¡Œè€—æ™‚æ“ä½œï¼ˆasync ä¸é˜»å¡ä¸»ç·šç¨‹ï¼‰
    let data = downloadLargeFile()

    // å›åˆ°ä¸»ç·šç¨‹æ›´æ–° UI
    DispatchQueue.main.async {
        self.imageView.image = UIImage(data: data)
    }
}

// å ´æ™¯ 2: éœ€è¦ç­‰å¾…çµæœï¼ˆä½¿ç”¨ syncï¼‰
var result: Int = 0
DispatchQueue.global().sync {
    result = heavyCalculation()
}
print("è¨ˆç®—çµæœ: \(result)")  // ä¿è­‰ result å·²ç¶“æœ‰å€¼

// å ´æ™¯ 3: ç·šç¨‹å®‰å…¨çš„è®€å¯«ï¼ˆä½¿ç”¨ Serial Queue + syncï¼‰
class ThreadSafeCounter {
    private var value = 0
    private let queue = DispatchQueue(label: "counter.queue")

    func increment() {
        queue.sync {  // sync ä¿è­‰åŸå­æ€§
            value += 1
        }
    }

    func getValue() -> Int {
        return queue.sync {  // sync ä¿è­‰è®€å–æ™‚ä¸è¢«ä¿®æ”¹
            return value
        }
    }
}
```

### Queue ä¸æ˜¯ Threadï¼

```swift
// ä¸€å€‹ Queue å¯ä»¥ä½¿ç”¨å¤šå€‹ Thread
let queue = DispatchQueue(label: "myQueue", attributes: .concurrent)

// é€™ 3 å€‹ä»»å‹™å¯èƒ½åˆ†é…åˆ°ä¸åŒçš„ Thread åŸ·è¡Œ
queue.async { /* Task 1 */ }
queue.async { /* Task 2 */ }
queue.async { /* Task 3 */ }

// ä½† Thread ä¸æœƒã€Œå±¬æ–¼ã€æŸå€‹ Queue
// Thread æ˜¯å¾ Thread Pool å‹•æ…‹åˆ†é…çš„
```

### ç‚ºä»€éº¼è¦ç”¨ Queueï¼Ÿ

1. **æŠ½è±¡åŒ–**ï¼šä¸éœ€è¦æ‰‹å‹•ç®¡ç†ç·šç¨‹çš„å‰µå»ºå’ŒéŠ·æ¯€
2. **è‡ªå‹•å„ªåŒ–**ï¼šç³»çµ±æ ¹æ“šç•¶å‰è² è¼‰è‡ªå‹•èª¿æ•´ç·šç¨‹æ•¸é‡
3. **é¿å…éåº¦é–‹éŠ·**ï¼šThread Pool é‡ç”¨ç·šç¨‹ï¼Œé¿å…é »ç¹å‰µå»º
4. **ç°¡åŒ–åŒæ­¥**ï¼šSerial Queue è‡ªå‹•æä¾›ç·šç¨‹å®‰å…¨

### âš ï¸ ç¶“å…¸å•é¡Œï¼šåœ¨ Main Queue åŸ·è¡Œ sync æœƒæ€æ¨£ï¼Ÿ

**ç­”æ¡ˆï¼šæœƒé€ æˆæ­»é–ï¼ˆDeadlockï¼‰ï¼ŒApp æœƒæ°¸ä¹…å¡ä½ï¼**

```swift
// âŒ é€™æ®µç¨‹å¼ç¢¼æœƒé€ æˆæ­»é–ï¼
// å‡è¨­ç›®å‰åœ¨ä¸»ç·šç¨‹åŸ·è¡Œ
DispatchQueue.main.sync {
    print("é€™è¡Œæ°¸é ä¸æœƒè¢«åŸ·è¡Œ")
}
print("é€™è¡Œä¹Ÿæ°¸é ä¸æœƒè¢«åŸ·è¡Œ")
```

### æ­»é–åŸå› åˆ†æ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ­»é–å½¢æˆéç¨‹                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  æ­¥é©Ÿ 1: ç¨‹å¼åœ¨ã€Œä¸»ç·šç¨‹ã€åŸ·è¡Œ                                    â”‚
â”‚         Main Thread æ­£åœ¨åŸ·è¡ŒæŸå€‹ä»»å‹™                             â”‚
â”‚                                                                  â”‚
â”‚  æ­¥é©Ÿ 2: å‘¼å« DispatchQueue.main.sync { ... }                   â”‚
â”‚         â€¢ sync çš„æ„æ€æ˜¯ã€ŒåŒæ­¥ã€= ç­‰å¾…ä»»å‹™å®Œæˆæ‰è¿”å›              â”‚
â”‚         â€¢ æ‰€ä»¥ Main Thread æœƒã€Œç­‰å¾…ã€é€™å€‹ Block åŸ·è¡Œå®Œç•¢         â”‚
â”‚                                                                  â”‚
â”‚  æ­¥é©Ÿ 3: Block è¢«åŠ å…¥ Main Queue                                 â”‚
â”‚         â€¢ Main Queue æ˜¯ä¸²è¡ŒéšŠåˆ—                                  â”‚
â”‚         â€¢ Block éœ€è¦åœ¨ Main Thread ä¸ŠåŸ·è¡Œ                        â”‚
â”‚         â€¢ ä½† Main Thread æ­£åœ¨ã€Œç­‰å¾…ã€é€™å€‹ Block å®Œæˆï¼           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   Main Thread   â”‚  ç­‰å¾…   â”‚   Main Queue    â”‚                â”‚
â”‚  â”‚   (æ­£åœ¨ç­‰å¾…     â”‚ â”€â”€â”€â”€â”€â–¶ â”‚   Block ç­‰å¾…    â”‚                â”‚
â”‚  â”‚    Block å®Œæˆ)  â”‚ â—€â”€â”€â”€â”€â”€ â”‚   Main Thread   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  éœ€è¦   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                  â”‚
â”‚  ğŸ’€ æ­»é–ï¼šäº’ç›¸ç­‰å¾…ï¼Œæ°¸é ç„¡æ³•å®Œæˆ                                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç”¨ç”Ÿæ´»ä¾‹å­ç†è§£

```
æƒ³åƒä½ æ˜¯ä¸€å€‹æœå‹™å“¡ï¼ˆMain Threadï¼‰ï¼Œåªæœ‰ä½ ä¸€å€‹äººå·¥ä½œï¼š

1. ä½ æ­£åœ¨æœå‹™å®¢äºº Aï¼ˆåŸ·è¡Œç•¶å‰ç¨‹å¼ç¢¼ï¼‰
2. å®¢äºº A èªªï¼šã€Œä½ å»å¹«æˆ‘åšä¸€ä»¶äº‹ï¼Œåšå®Œå†å›ä¾†ã€ï¼ˆsyncï¼‰
3. é€™ä»¶äº‹éœ€è¦ã€Œä½ ã€ä¾†åšï¼ˆMain Queue çš„ä»»å‹™åªèƒ½åœ¨ Main Thread åŸ·è¡Œï¼‰
4. ä½†ä½ æ­£åœ¨ã€Œç­‰å¾…ã€é€™ä»¶äº‹å®Œæˆ...
5. è€Œé€™ä»¶äº‹éœ€è¦ã€Œä½ ã€å»åš...

ğŸ’€ ä½ æ°¸é å¡ä½äº†ï¼
```

### æ­£ç¢ºåšæ³•

```swift
// âœ… æ–¹æ³• 1: ä½¿ç”¨ asyncï¼ˆéé˜»å¡ï¼‰
DispatchQueue.main.async {
    print("é€™æ¨£å°±å®‰å…¨äº†")
}

// âœ… æ–¹æ³• 2: æª¢æŸ¥æ˜¯å¦åœ¨ä¸»ç·šç¨‹ï¼Œé¿å…ä¸å¿…è¦çš„èª¿åº¦
if Thread.isMainThread {
    // å·²ç¶“åœ¨ä¸»ç·šç¨‹ï¼Œç›´æ¥åŸ·è¡Œ
    updateUI()
} else {
    // ä¸åœ¨ä¸»ç·šç¨‹ï¼Œèª¿åº¦åˆ°ä¸»ç·šç¨‹
    DispatchQueue.main.async {
        updateUI()
    }
}

// âœ… æ–¹æ³• 3: å¾å…¶ä»–ç·šç¨‹èª¿ç”¨ syncï¼ˆé€™æ¨£ä¸æœƒæ­»é–ï¼‰
DispatchQueue.global().async {
    // é€™è£¡æ˜¯èƒŒæ™¯ç·šç¨‹
    DispatchQueue.main.sync {
        // å¾èƒŒæ™¯ç·šç¨‹ sync åˆ°ä¸»ç·šç¨‹æ˜¯å®‰å…¨çš„
        // å› ç‚ºèƒŒæ™¯ç·šç¨‹æœƒç­‰å¾…ï¼Œè€Œä¸»ç·šç¨‹å¯ä»¥åŸ·è¡Œ
        print("å®‰å…¨åŸ·è¡Œ")
    }
}
```

### åŒæ¨£çš„å•é¡Œä¹Ÿæœƒç™¼ç”Ÿåœ¨ä»»ä½• Serial Queue

```swift
let serialQueue = DispatchQueue(label: "com.example.serial")

serialQueue.async {
    // ç¾åœ¨åœ¨ serialQueue çš„ç·šç¨‹ä¸Š

    serialQueue.sync {
        // âŒ æ­»é–ï¼åŒæ¨£çš„é“ç†
        print("æ°¸é ä¸æœƒåŸ·è¡Œ")
    }
}
```

### ç¸½çµè¡¨æ ¼

| æƒ…æ³                                      | çµæœ    | åŸå›                        |
| ----------------------------------------- | ------- | -------------------------- |
| ä¸»ç·šç¨‹å‘¼å« `DispatchQueue.main.sync`      | âŒ æ­»é– | ä¸»ç·šç¨‹ç­‰å¾…è‡ªå·±             |
| èƒŒæ™¯ç·šç¨‹å‘¼å« `DispatchQueue.main.sync`    | âœ… å®‰å…¨ | èƒŒæ™¯ç·šç¨‹ç­‰å¾…ï¼Œä¸»ç·šç¨‹å¯åŸ·è¡Œ |
| Serial Queue å…§å‘¼å«åŒä¸€å€‹ Queue çš„ `sync` | âŒ æ­»é– | è©²ç·šç¨‹ç­‰å¾…è‡ªå·±             |
| ä»»ä½•åœ°æ–¹å‘¼å« `DispatchQueue.main.async`   | âœ… å®‰å…¨ | async ä¸ç­‰å¾…               |

---

## å››ã€Coroutineï¼ˆå”ç¨‹ï¼‰èˆ‡ Swift Concurrency

### âš ï¸ é‡è¦æ¾„æ¸…ï¼šiOS æœ‰ã€Œå”ç¨‹ã€å—ï¼Ÿ

**åš´æ ¼ä¾†èªªï¼ŒiOS/Swift æ²’æœ‰å‚³çµ±æ„ç¾©ä¸Šçš„ã€Œå”ç¨‹ã€ã€‚**

| èªè¨€/å¹³å°     | å”ç¨‹å¯¦ç¾        | å®˜æ–¹åç¨±              |
| ------------- | --------------- | --------------------- |
| Kotlin        | âœ… æœ‰           | Coroutines            |
| Go            | âœ… æœ‰           | Goroutines            |
| Python        | âœ… æœ‰           | asyncio / Coroutines  |
| **Swift/iOS** | âŒ æ²’æœ‰å‚³çµ±å”ç¨‹ | **Swift Concurrency** |

Swift 5.5 å¼•å…¥çš„ `async/await` **åœ¨è¡Œç‚ºä¸Šé¡ä¼¼å”ç¨‹**ï¼Œä½†ï¼š

1. **Apple å®˜æ–¹ä¸ç¨±ä¹‹ç‚ºã€Œå”ç¨‹ã€**ï¼Œè€Œæ˜¯å« **Swift Concurrencyï¼ˆçµæ§‹åŒ–ä¸¦ç™¼ï¼‰**
2. **åº•å±¤ä»ä¾è³´ GCD å’Œç·šç¨‹æ± **ï¼Œä¸æ˜¯ç´”ç²¹çš„ç”¨æˆ¶æ…‹èª¿åº¦
3. **æ²’æœ‰ç¨ç«‹çš„å”ç¨‹èª¿åº¦å™¨**ï¼ŒTask æœ€çµ‚æœƒè¢«åˆ†é…åˆ°ç·šç¨‹åŸ·è¡Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å‚³çµ±å”ç¨‹ vs Swift Concurrency                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ã€å‚³çµ±å”ç¨‹ (Kotlin/Go)ã€‘                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚  å”ç¨‹èª¿åº¦å™¨      â”‚  â† èªè¨€é‹è¡Œæ™‚ç®¡ç†ï¼Œå®Œå…¨ç”¨æˆ¶æ…‹          â”‚
â”‚  â”‚  Coroutine 1    â”‚                                        â”‚
â”‚  â”‚  Coroutine 2    â”‚                                        â”‚
â”‚  â”‚  Coroutine N    â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚           â†“                                                  â”‚
â”‚      å°‘é‡ç·šç¨‹                                                â”‚
â”‚                                                              â”‚
â”‚  ã€Swift Concurrencyã€‘                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚  Task 1         â”‚                                        â”‚
â”‚  â”‚  Task 2         â”‚  â† é¡ä¼¼å”ç¨‹çš„ã€Œæš«åœ/æ¢å¾©ã€è¡Œç‚º          â”‚
â”‚  â”‚  Task N         â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚           â†“                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚  GCD / ç·šç¨‹æ±     â”‚  â† åº•å±¤ä»æ˜¯ GCD ç®¡ç†ç·šç¨‹               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç‚ºä»€éº¼èªª async/awaitã€Œé¡ä¼¼ã€å”ç¨‹ï¼Ÿ

é›–ç„¶ä¸æ˜¯å‚³çµ±å”ç¨‹ï¼Œä½† Swift çš„ async/await å…·æœ‰å”ç¨‹çš„é—œéµç‰¹æ€§ï¼š

| ç‰¹æ€§              | å‚³çµ±å”ç¨‹ | Swift async/await |
| ----------------- | -------- | ----------------- |
| å¯æš«åœï¼ˆSuspendï¼‰ | âœ…       | âœ…                |
| å¯æ¢å¾©ï¼ˆResumeï¼‰  | âœ…       | âœ…                |
| ä¸é˜»å¡ç·šç¨‹        | âœ…       | âœ…                |
| è¼•é‡ç´š            | âœ…       | âœ…                |
| ç´”ç”¨æˆ¶æ…‹èª¿åº¦      | âœ…       | âŒï¼ˆä¾è³´ GCDï¼‰    |
| ç¨ç«‹å”ç¨‹èª¿åº¦å™¨    | âœ…       | âŒ                |

### ä»€éº¼æ˜¯å”ç¨‹ï¼Ÿï¼ˆé€šç”¨æ¦‚å¿µï¼‰

å”ç¨‹æ˜¯ä¸€ç¨®**ç”¨æˆ¶æ…‹çš„è¼•é‡ç´šåŸ·è¡Œå–®å…ƒ**ï¼Œå¯ä»¥åœ¨åŸ·è¡Œéç¨‹ä¸­**æš«åœï¼ˆsuspendï¼‰**ä¸¦åœ¨ç¨å¾Œ**æ¢å¾©ï¼ˆresumeï¼‰**ï¼Œè€Œä¸æœƒé˜»å¡ç·šç¨‹ã€‚

### å”ç¨‹ vs ç·šç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç·šç¨‹ (Thread)                         â”‚
â”‚                                                              â”‚
â”‚    ä»»å‹™ A â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶           â”‚
â”‚                                                              â”‚
â”‚    ç­‰å¾… I/O æ™‚ï¼Œæ•´å€‹ç·šç¨‹è¢«é˜»å¡ï¼                             â”‚
â”‚    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å”ç¨‹ (Coroutine)                      â”‚
â”‚                                                              â”‚
â”‚    å”ç¨‹ A â”€â”€â”€â”€â–¶ suspend â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ resume â”€â”€â”€â”€â–¶      â”‚
â”‚                    â”‚                        â–²                â”‚
â”‚                    â–¼                        â”‚                â”‚
â”‚    å”ç¨‹ B â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ç¹¼çºŒåŸ·è¡Œå…¶ä»–å”ç¨‹                 â”‚
â”‚                                                              â”‚
â”‚    ç­‰å¾… I/O æ™‚ï¼Œå”ç¨‹æš«åœï¼Œç·šç¨‹å¯åŸ·è¡Œå…¶ä»–å”ç¨‹ï¼               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ç‰¹æ€§       | ç·šç¨‹ (Thread)        | å”ç¨‹ (Coroutine)          |
| ---------- | -------------------- | ------------------------- |
| èª¿åº¦è€…     | OS æ ¸å¿ƒ              | ç”¨æˆ¶æ…‹ï¼ˆèªè¨€é‹è¡Œæ™‚ï¼‰      |
| ä¸Šä¸‹æ–‡åˆ‡æ› | é‡ï¼ˆéœ€è¦ OS ä»‹å…¥ï¼‰   | è¼•ï¼ˆä¸éœ€è¦ OS ä»‹å…¥ï¼‰      |
| è¨˜æ†¶é«”é–‹éŠ· | å¤§ï¼ˆæ¯å€‹ 512KB-1MBï¼‰ | å°ï¼ˆé€šå¸¸å¹¾ KBï¼‰           |
| æ•¸é‡é™åˆ¶   | æœ‰é™ï¼ˆé€šå¸¸å¹¾åƒå€‹ï¼‰   | å¯ä»¥æœ‰æ•¸åè¬å€‹            |
| é˜»å¡æ™‚     | æ•´å€‹ç·šç¨‹è¢«é˜»å¡       | åªæœ‰å”ç¨‹æš«åœï¼Œç·šç¨‹å¯ç”¨    |
| ä¸¦è¡Œæ€§     | çœŸæ­£çš„ä¸¦è¡Œ           | å”ä½œå¼å¤šå·¥ï¼ˆCooperativeï¼‰ |

### Swift ä¸­çš„å”ç¨‹ï¼šasync/await

Swift 5.5 å¼•å…¥çš„ `async/await` å°±æ˜¯å”ç¨‹çš„å¯¦ç¾ï¼š

```swift
// é€™æ˜¯ä¸€å€‹å”ç¨‹å‡½æ•¸
func fetchData() async throws -> Data {
    // await æ˜¯æš«åœé»ï¼ˆsuspension pointï¼‰
    // ç·šç¨‹ä¸æœƒè¢«é˜»å¡ï¼Œå¯ä»¥åŸ·è¡Œå…¶ä»–ä»»å‹™
    let (data, _) = try await URLSession.shared.data(from: url)
    return data
}

// ç•¶åŸ·è¡Œåˆ° await æ™‚ï¼š
// 1. å”ç¨‹æš«åœï¼Œä¿å­˜ç•¶å‰ç‹€æ…‹
// 2. ç·šç¨‹è¢«é‡‹æ”¾ï¼Œå¯åŸ·è¡Œå…¶ä»–ä»»å‹™
// 3. ç¶²è·¯è«‹æ±‚å®Œæˆå¾Œï¼Œå”ç¨‹æ¢å¾©åŸ·è¡Œ
```

### å”ç¨‹çš„åŸ·è¡Œæ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Cooperative Executor                    â”‚
â”‚                                                             â”‚
â”‚  Time â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶      â”‚
â”‚                                                             â”‚
â”‚  Thread:  â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”              â”‚
â”‚           â”‚Coro Aâ”‚     â”‚Coro Bâ”‚     â”‚Coro Aâ”‚              â”‚
â”‚           â”‚ run  â”‚     â”‚ run  â”‚     â”‚resumeâ”‚              â”‚
â”‚           â””â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚              â”‚            â”‚                                 â”‚
â”‚           suspend      suspend                              â”‚
â”‚           (await)      (await)                              â”‚
â”‚                                                             â”‚
â”‚  ä¸€å€‹ç·šç¨‹å¯ä»¥åŸ·è¡Œå¤šå€‹å”ç¨‹ï¼Œé€šé suspend/resume åˆ‡æ›         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€å››è€…çš„é—œä¿‚ç¸½çµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä½œæ¥­ç³»çµ± (Operating System)                       â”‚
â”‚                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚                    Processï¼ˆé€²ç¨‹ï¼‰                         â”‚     â”‚
â”‚   â”‚                    = ä½ çš„ iOS App                          â”‚     â”‚
â”‚   â”‚                                                            â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚   â”‚  â”‚            Coroutines (å”ç¨‹å±¤)                       â”‚  â”‚     â”‚
â”‚   â”‚  â”‚   â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”       â”‚  â”‚     â”‚
â”‚   â”‚  â”‚   â”‚ C1 â”‚ â”‚ C2 â”‚ â”‚ C3 â”‚ â”‚ C4 â”‚ â”‚ C5 â”‚ â”‚ C6 â”‚  ...  â”‚  â”‚     â”‚
â”‚   â”‚  â”‚   â””â”€â”€â”¬â”€â”˜ â””â”€â”€â”¬â”€â”˜ â””â”€â”€â”¬â”€â”˜ â””â”€â”€â”¬â”€â”˜ â””â”€â”€â”¬â”€â”˜ â””â”€â”€â”¬â”€â”˜       â”‚  â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚   â”‚         â”‚      â”‚      â”‚      â”‚      â”‚      â”‚            â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚   â”‚  â”‚      â–¼      â–¼      â–¼      â–¼      â–¼      â–¼         â”‚  â”‚     â”‚
â”‚   â”‚  â”‚         Queues (ä½‡åˆ—å±¤ - GCD)                      â”‚  â”‚     â”‚
â”‚   â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  â”‚     â”‚
â”‚   â”‚  â”‚   â”‚Serial Queueâ”‚    â”‚Concurrent Queueâ”‚            â”‚  â”‚     â”‚
â”‚   â”‚  â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚   â”‚            â”‚                    â”‚                        â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚   â”‚  â”‚         â–¼                    â–¼                     â”‚  â”‚     â”‚
â”‚   â”‚  â”‚         Thread Pool (ç·šç¨‹å±¤ - OS ç®¡ç†)             â”‚  â”‚     â”‚
â”‚   â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚  â”‚     â”‚
â”‚   â”‚  â”‚   â”‚Thread 1 â”‚  â”‚Thread 2 â”‚  â”‚Thread 3 â”‚   ...     â”‚  â”‚     â”‚
â”‚   â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚  â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚   â”‚                                                          â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                      â”‚
â”‚   å…¶ä»– Processï¼ˆå…¶ä»– Appï¼‰åœ¨ç¨ç«‹çš„è¨˜æ†¶é«”ç©ºé–“                          â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å±¤ç´šé—œä¿‚ï¼ˆç”±å¤§åˆ°å°ï¼‰ï¼š
- Process æ˜¯è³‡æºåˆ†é…çš„å–®ä½ï¼Œæ¯å€‹ App æ˜¯ä¸€å€‹ Process
- Thread æ˜¯ CPU èª¿åº¦çš„å–®ä½ï¼Œåœ¨ Process å…§åŸ·è¡Œ
- Queue æ˜¯ä»»å‹™èª¿åº¦çš„æŠ½è±¡ï¼Œç®¡ç†ä»»å‹™åˆ†é…çµ¦å“ªå€‹ Thread
- Coroutine æ˜¯æœ€è¼•é‡çš„åŸ·è¡Œå–®å…ƒï¼Œå¤šå€‹å”ç¨‹å¯åœ¨ä¸€å€‹ Thread ä¸Šäº¤æ›¿åŸ·è¡Œ
```

---

## å…­ã€å¯¦éš›æ‡‰ç”¨å ´æ™¯

### 1. ä»€éº¼æ™‚å€™ç”¨ Threadï¼Ÿ

```swift
// å¾ˆå°‘ç›´æ¥ä½¿ç”¨ï¼Œé™¤ééœ€è¦ç²¾ç´°æ§åˆ¶
let thread = Thread {
    // é•·æœŸé‹è¡Œçš„èƒŒæ™¯ä»»å‹™
    RunLoop.current.run()
}
thread.name = "MyBackgroundThread"
thread.qualityOfService = .background
thread.start()
```

### 2. ä»€éº¼æ™‚å€™ç”¨ Queueï¼ˆGCDï¼‰ï¼Ÿ

```swift
// å¤§å¤šæ•¸æƒ…æ³çš„é¦–é¸
DispatchQueue.global().async {
    // èƒŒæ™¯ä»»å‹™
    let result = heavyComputation()

    DispatchQueue.main.async {
        // UI æ›´æ–°
        self.updateUI(with: result)
    }
}
```

### 3. ä»€éº¼æ™‚å€™ç”¨å”ç¨‹ï¼ˆasync/awaitï¼‰ï¼Ÿ

```swift
// ç¾ä»£ Swift ç•°æ­¥ç¨‹å¼è¨­è¨ˆçš„é¦–é¸
func loadAndDisplayImage() async throws {
    // ç¶²è·¯è«‹æ±‚ä¸æœƒé˜»å¡ç·šç¨‹
    let imageData = try await fetchImageData()

    // è™•ç†åœ–ç‰‡
    let image = try await processImage(imageData)

    // è‡ªå‹•å›åˆ°ä¸»ç·šç¨‹ï¼ˆå¦‚æœéœ€è¦ï¼‰
    await MainActor.run {
        imageView.image = image
    }
}
```

---

## ä¸ƒã€é¢è©¦é‡é»

1. **Process å’Œ Thread çš„å€åˆ¥æ˜¯ä»€éº¼ï¼Ÿ**

   - Process æ˜¯è³‡æºåˆ†é…çš„åŸºæœ¬å–®ä½ï¼ŒThread æ˜¯ CPU èª¿åº¦çš„åŸºæœ¬å–®ä½
   - Process æœ‰ç¨ç«‹çš„è¨˜æ†¶é«”ç©ºé–“ï¼ŒThread å…±äº«æ‰€å±¬ Process çš„è¨˜æ†¶é«”
   - Process ä¹‹é–“é€šä¿¡éœ€è¦ IPCï¼ŒThread å¯ç›´æ¥å…±äº«è¨˜æ†¶é«”
   - Process å´©æ½°ä¸å½±éŸ¿å…¶ä»– Processï¼ŒThread å´©æ½°å¯èƒ½å°è‡´æ•´å€‹ Process å´©æ½°

2. **iOS App èˆ‡ Process çš„é—œä¿‚ï¼Ÿ**

   - æ¯å€‹ iOS App é‹è¡Œæ™‚å°±æ˜¯ä¸€å€‹ç¨ç«‹çš„ Process
   - iOS ç³»çµ±é€šéé€²ç¨‹éš”é›¢ä¿è­‰ App ä¹‹é–“çš„å®‰å…¨æ€§å’Œç©©å®šæ€§
   - App è¢«çµ‚æ­¢æ™‚ï¼Œå°æ‡‰çš„ Process æœƒè¢«éŠ·æ¯€ï¼Œé‡‹æ”¾æ‰€æœ‰è³‡æº

3. **Queue å’Œ Thread çš„å€åˆ¥æ˜¯ä»€éº¼ï¼Ÿ**

   - Queue æ˜¯ä»»å‹™èª¿åº¦çš„æŠ½è±¡å®¹å™¨
   - Thread æ˜¯å¯¦éš›åŸ·è¡Œä»»å‹™çš„è¼‰é«”
   - ä¸€å€‹ Queue å¯èƒ½ä½¿ç”¨å¤šå€‹ Thread

4. **syncï¼ˆåŒæ­¥ï¼‰å’Œ asyncï¼ˆç•°æ­¥ï¼‰çš„å€åˆ¥æ˜¯ä»€éº¼ï¼Ÿï¼ˆâ­ é«˜é »è€ƒé¡Œï¼‰**

   - **sync**ï¼šç­‰å¾…ä»»å‹™å®Œæˆæ‰è¿”å›ï¼Œé˜»å¡ç•¶å‰ç·šç¨‹
   - **async**ï¼šç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…ï¼Œä¸é˜»å¡ç•¶å‰ç·šç¨‹
   - sync åƒæ‰“é›»è©±ï¼ˆç­‰å°æ–¹æ¥è½ï¼‰ï¼›async åƒç™¼è¨Šæ¯ï¼ˆç™¼å®Œå°±ç¹¼çºŒåšäº‹ï¼‰
   - æ³¨æ„ï¼šsync å¯èƒ½å°è‡´æ­»é–ï¼ˆå¦‚ä¸»ç·šç¨‹ sync åˆ° Main Queueï¼‰

5. **åœ¨ Main Queue åŸ·è¡Œ sync æœƒæ€æ¨£ï¼Ÿï¼ˆâ­ ç¶“å…¸è€ƒé¡Œï¼‰**

   - **æœƒé€ æˆæ­»é–ï¼ˆDeadlockï¼‰ï¼**
   - åŸå› ï¼šä¸»ç·šç¨‹åœ¨ç­‰å¾… sync ä»»å‹™å®Œæˆï¼Œä½†è©²ä»»å‹™éœ€è¦ä¸»ç·šç¨‹åŸ·è¡Œ
   - å½¢æˆã€Œä¸»ç·šç¨‹ç­‰è‡ªå·±ã€çš„æ­»å¾ªç’°
   - è§£æ³•ï¼šä½¿ç”¨ `async` æˆ–å…ˆæª¢æŸ¥ `Thread.isMainThread`

6. **iOS æœ‰å”ç¨‹å—ï¼Ÿï¼ˆâ­ é‡è¦ï¼‰**

   - **åš´æ ¼ä¾†èªªæ²’æœ‰**ï¼ŒSwift æ²’æœ‰å‚³çµ±æ„ç¾©ä¸Šçš„å”ç¨‹
   - Swift 5.5 çš„ async/await æ˜¯ **Swift Concurrency**ï¼Œä¸æ˜¯å”ç¨‹
   - é›–ç„¶è¡Œç‚ºé¡ä¼¼ï¼ˆå¯æš«åœ/æ¢å¾©ï¼‰ï¼Œä½†åº•å±¤ä»ä¾è³´ GCD ç·šç¨‹æ± 
   - èˆ‡ Kotlin Coroutinesã€Go Goroutines çš„ç´”ç”¨æˆ¶æ…‹èª¿åº¦ä¸åŒ

7. **å”ç¨‹å’Œç·šç¨‹çš„å€åˆ¥æ˜¯ä»€éº¼ï¼Ÿï¼ˆé€šç”¨æ¦‚å¿µï¼‰**

   - å”ç¨‹æ˜¯ç”¨æˆ¶æ…‹ã€è¼•é‡ç´šã€å”ä½œå¼èª¿åº¦
   - ç·šç¨‹æ˜¯æ ¸å¿ƒæ…‹ã€é‡é‡ç´šã€æ¶å å¼èª¿åº¦
   - å”ç¨‹æš«åœæ™‚ä¸é˜»å¡ç·šç¨‹

8. **ç‚ºä»€éº¼å”ç¨‹æ›´é«˜æ•ˆï¼Ÿ**

   - ä¸Šä¸‹æ–‡åˆ‡æ›ä¸éœ€è¦ OS ä»‹å…¥
   - è¨˜æ†¶é«”é–‹éŠ·æ›´å°
   - å¯ä»¥å‰µå»ºå¤§é‡å”ç¨‹

9. **Swift Concurrency (async/await) çš„ç‰¹é»ï¼Ÿ**

   - èªæ³•ä¸Šé¡ä¼¼å”ç¨‹ï¼Œæ”¯æŒæš«åœ/æ¢å¾©
   - åº•å±¤ä»ä½¿ç”¨ GCD ç®¡ç†ç·šç¨‹
   - Task å‰µå»ºç•°æ­¥ä»»å‹™
   - Actor ç¢ºä¿ç·šç¨‹å®‰å…¨
   - @MainActor ç¢ºä¿åœ¨ä¸»ç·šç¨‹åŸ·è¡Œ

10. **GCD ä¸­ Queue å¦‚ä½•åˆ†é… Threadï¼Ÿ**

    - Thread Pool è‡ªå‹•ç®¡ç†
    - ç³»çµ±æ ¹æ“šè² è¼‰å‹•æ…‹èª¿æ•´
    - é–‹ç™¼è€…ä¸éœ€è¦æ‰‹å‹•ç®¡ç†

11. **é€™å››å€‹æ¦‚å¿µçš„å±¤ç´šé—œä¿‚æ˜¯ä»€éº¼ï¼Ÿ**

    - Process > Thread > Queue > Coroutine/Taskï¼ˆå¾é‡åˆ°è¼•ï¼‰
    - Process åŒ…å«å¤šå€‹ Thread
    - Thread åŸ·è¡Œ Queue ä¸­çš„ä»»å‹™
    - å¤šå€‹ Task (async/await) å¯åœ¨ä¸€å€‹ Thread ä¸Šäº¤æ›¿åŸ·è¡Œ
